cmake_minimum_required(VERSION 3.8)
project(telemetry_streamer_odom)

### 1. åŸºç¡€ä¾èµ–ï¼ˆROS2ï¼‰
find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)
find_package(nav_msgs REQUIRED)
find_package(ament_index_cpp REQUIRED)

# ğŸ‘‡ æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ find_package(tinyxml2 REQUIRED)
# å› ä¸ºä½ çš„ç¯å¢ƒæ²¡æœ‰ tinyxml2Config.cmake
# æˆ‘ä»¬å°†ç›´æ¥æ‰‹åŠ¨é“¾æ¥ç³»ç»Ÿåº“ libtinyxml2.soï¼Œè€Œä¸æ˜¯ä¾èµ– tinyxml2::tinyxml2

### 2. å¯æ‰§è¡Œæ–‡ä»¶ï¼šæŠŠæ‰€æœ‰ .cpp éƒ½æ”¾è¿›æ¥
add_executable(telemetry_streamer_odom_node
    src/main.cpp
    src/config.cpp
    src/telemetry_streamer_node.cpp
    src/field_kind_dispatch.cpp
    src/topic_extractors.cpp
)

### 3. ament ä¾èµ–ï¼ˆé™¤äº† tinyxml2 ä»¥å¤–ï¼‰
ament_target_dependencies(telemetry_streamer_odom_node
    rclcpp
    nav_msgs
    ament_index_cpp
)

### 4. å¤´æ–‡ä»¶æœç´¢è·¯å¾„
target_include_directories(telemetry_streamer_odom_node PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
    $<INSTALL_INTERFACE:include>
)

### 5. æ‰‹åŠ¨é“¾æ¥ç³»ç»Ÿ tinyxml2 åº“
# è¿™ä¸€æ­¥å‡è®¾ä½ å·²ç»åœ¨ç³»ç»Ÿé‡Œå®‰è£…äº† libtinyxml2-dev
# - å¤´æ–‡ä»¶ tinyxml2.h é€šå¸¸åœ¨ /usr/include
# - åº“æ–‡ä»¶ libtinyxml2.so é€šå¸¸åœ¨ /usr/lib/x86_64-linux-gnu
#
# æˆ‘ä»¬ä¸ä½¿ç”¨ tinyxml2::tinyxml2 è¿™ä¸ª target åï¼Œè€Œæ˜¯ç›´æ¥å‘Šè¯‰é“¾æ¥å™¨ -ltinyxml2
target_link_libraries(telemetry_streamer_odom_node
    tinyxml2
)

### 6. å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¾› ros2 run è°ƒç”¨ï¼‰
install(TARGETS telemetry_streamer_odom_node
    DESTINATION lib/${PROJECT_NAME}
)

### 7. å®‰è£…å¤´æ–‡ä»¶ï¼ˆè®©åˆ«çš„åŒ…ä¹Ÿèƒ½ include æˆ‘ä»¬çš„å¤´ï¼‰
install(DIRECTORY include/
    DESTINATION include/
)

### 8. å®‰è£…è¿è¡Œæ—¶é…ç½®ï¼ˆä¾‹å¦‚ XML é…ç½®æ–‡ä»¶ï¼‰
install(DIRECTORY config/
    DESTINATION share/${PROJECT_NAME}/config
)

### 9. å®Œæˆ ament åŒ…å¯¼å‡º
ament_package()
